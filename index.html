<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cellular Automata</title>

    <!-- SEO -->
    <meta name="description" content="Interactive cellular automata simulator â€” Chaos disguised as order.">
    <meta name="keywords" content="cellular automata, game of life, conway, life">
    <meta name="robots" content="index, follow">

    <!-- Icons -->
    <link rel="icon" href="./assets/LOGO.png" type="image/x-icon">
    <link rel="shortcut icon" href="./assets/LOGO.png">
    <link rel="apple-touch-icon" href="./assets/LOGO.png">

    <!-- Styles & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="./styles.css">

</head>

<body>
    <!-- Toggle Button -->
    <button id="menuToggle" class="toggle-panel-btn">
        <i class="bi bi-three-dots-vertical"></i>
    </button>

    <!-- Collapsible Side Panel -->
    <div class="sidenav" id="menuPanel">

        <!-- Vertical Tabs on the left -->
        <div class="sidenav-tabs">
            <button class="tab-btn active" data-panel="aboutPanel">
                <i class="bi bi-info-circle-fill"></i>
            </button>
            <button class="tab-btn" data-panel="gridPanel" title="Grid Controls">
                <i class="bi bi-grid-3x3-gap-fill"></i>
            </button>
            <button class="tab-btn" data-panel="drawPanel">
                <i class="bi bi-pencil-fill"></i>
            </button>
            <button class="tab-btn" data-panel="logicPanel" title="Automata Logic">
                <i class="bi bi-cpu-fill"></i>
            </button>
            <button class="tab-btn" data-panel="statsPanel" title="Statistics">
                <i class="bi bi-graph-up"></i>
            </button>
        </div>

        <!-- Panel Content -->
        <div class="sidenav-panels">
            <!-- About Panel -->
            <div class="panel active" id="aboutPanel">
                <div class="panel-header">
                    <h3><i class="bi bi-info-circle-fill me-2"></i> Cellular Automaton</h3>
                </div>
                <div class="container">
                    <!-- Your main panel content here -->

                    <!-- Footer section at bottom of panel -->
                    <div class="mt-auto pt-3 border-top">
                        <div class="mb-2">
                            &copy; <span id="year"></span> Abbas Moosajee &nbsp;|&nbsp;
                            <a href="https://github.com/abbasmoosajee07/cellular-automata" target="_blank" title="View Source Code" class="text-dark text-decoration-none">
                                <i class="bi bi-github align-middle"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grid Panel -->
            <div class="panel" id="gridPanel">
                <div class="panel-header">
                    <h3><i class="bi bi-grid-3x3-gap-fill me-2"></i> Grid Controls</h3>
                </div>
                <button class="action-btn" id="themeToggle" aria-label="Toggle theme">
                    <span id="themeText" class="ms-2"></span>
                    <i id="themeIcon" class="bi"></i>
                </button>

                <!-- Tile Shapes -->
                <div class="config-group">
                    <h3>Cell Shapes:</h3>
                    <div class="config-row">
                        <div class="config-option">
                            <input type="radio" id="shape-square" name="shape" value="square" checked>
                            <label for="shape-square">Square</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="shape-hex" name="shape" value="hex">
                            <label for="shape-hex">Hexagons</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="shape-triangle" name="shape" value="triangle">
                            <label for="shape-triangle">Triangle</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="shape-rhombus" name="shape" value="rhombus">
                            <label for="shape-rhombus">Rhombus</label>
                        </div>
                    </div>
                </div>

                <!-- Boundary Behaviour -->
                <div class="config-group">
                    <h3>Boundary Behavior</h3>
                    <div class="config-row">
                        <div class="config-option">
                            <input type="radio" id="bounds-infinite" name="bounds" value="infinite">
                            <label for="bounds-infinite">Infinite</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="bounds-wrap" name="bounds" value="wrap-around" checked>
                            <label for="bounds-wrap">Wrap-around</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="bounds-bounded" name="bounds" value="bounded">
                            <label for="bounds-bounded">Bounded</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="bounds-cliff" name="bounds" value="cliff">
                            <label for="bounds-cliff">Fall off</label>
                        </div>
                    </div>
                </div>

                <!-- Neighbor Rules -->
                <div class="config-group">
                    <h3>Neighbor Rules</h3>
                    <div class="config-row">
                        <div class="config-option">
                            <input type="radio" id="neighbors-adjacent" name="neighbors" value="adjacent" checked>
                            <label for="neighbors-adjacent">Adjacent Only</label>
                        </div>
                        <div class="config-option">
                            <input type="radio" id="neighbors-touching" name="neighbors" value="touching">
                            <label for="neighbors-touching">All Touching</label>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <label for="colInput">Cols:</label>
                    <input type="number" class="grid-size-in" id="colInput" min="1" max = "16382" value="20" step="1">
                </div>

                <div class="form-row">
                    <label for="rowInput">Rows:</label>
                    <input type="number" class="grid-size-in" id="rowInput" min="1" max = "16382" value="20" step="1">
                </div>
                <div class="form-row">
                    <label for="useWebgl">Use Webgl</label>
                    <input type="checkbox" id="useWebgl"  onclick="switchRenderers()" checked>
                </div>
                <button id="reMap" class="btn btn-remap action-btn">
                    <i class="bi bi-arrow-repeat me-2"></i> Re-Map World
                </button>

            </div>

            <!-- Draw Panel -->
            <div class="panel" id="drawPanel">
                <div class="panel-header">
                    <h3><i class="bi bi-pencil-fill me-2"></i> Drawing Tools</h3>
                </div>

                <div class="form-row">
                    <label for="drawTiles">Draw Tiles</label>
                    <input type="checkbox" id="drawTiles" checked>
                </div>

                <div class="form-row">
                    <label for="eraseTiles">Erase Tiles</label>
                    <input type="checkbox" id="eraseTiles">
                </div>

                <button id="clearGrid" class="action-btn" title="Clear">
                    <i class="bi bi-trash-fill"></i> Clear
                </button>

                <button id="randomFill" class="action-btn" title="Random">
                    <i class="bi bi-shuffle"></i> Random
                </button>
                <button id="neighborTiles" class="action-btn" title="Add Neighbors">
                    <i class="bi bi-bounding-box"></i> Neighbor Tiles
                </button>
            </div>

            <!-- Logic Panel -->
            <div class="panel" id="logicPanel">
                <div class="panel-header">
                    <h3><i class="bi bi-cpu-fill me-2"></i> Automata Logic</h3>
                </div>
                <!-- Add your logic panel content here -->
            </div>

            <!-- Stats Panel -->
            <div class="panel" id="statsPanel">
                <div class="panel-header">
                    <h3><i class="bi bi-graph-up me-2"></i> Statistics</h3>
                </div>
                <!-- Add your stats panel content here -->
            </div>
        </div>
    </div>

    <!-- Main Canvas -->
    <canvas id="gridCanvas"></canvas>

    <!-- ðŸ§­ Control Panel -->
    <div class="ui-panel control-panel">
        <button id="resetView" class="control-btn" title="Reset View">
        <i class="bi bi-camera-video-fill"></i>
        </button>

        <button id="pinLoc" class="control-btn" title="Pin Location">
        <i class="bi bi-pin-map-fill"></i>
        </button>

        <button id="simCtrl" class="control-btn" title="Start Simulation">
        <i class="bi bi-play-fill"></i>
        </button>
    </div>

    <!-- ðŸ“Š Status Bar -->
    <div id="statusBar" class="ui-panel">
    <div class="status-item">
        <span class="status-label">Generation:</span>
        <span id="status-gen">0</span>
    </div>
    <div class="status-item">
        <span class="status-label">Population:</span>
        <span id="status-popl">0</span>
    </div>
    <div class="status-item">
        <span class="status-label">Zoom:</span>
        <span id="status-zoom">1.00x</span>
    </div>
    <div class="status-item">
        <span class="status-label">Camera:</span>
        <span id="status-camera">(0, 0)</span>
    </div>
    </div>
</body>

<script src="./scripts/utils.js"></script>
<script type = "module">
    import { SimulatorController } from './scripts/main.js';

    // ===== SIMULATOR INITIALIZATION =====
    let simulator = new SimulatorController();
    simulator.initSim(true); // async initialization

    window.switchRenderers = function () {
        const checkbox = document.getElementById("useWebgl");
        const useWebgl = checkbox.checked;

        const confirmed = confirm("Switch rendering mode? This will restart the simulator.");
        if (!confirmed) {
            // Revert checkbox state if user cancels
            checkbox.checked = !useWebgl;
            return;
        }

        // --- Safely clean up old simulator ---
        try {
            if (simulator && typeof simulator.delElements === "function") {
                simulator.delElements();
            }
            if (simulator && typeof simulator.destroy === "function") {
                simulator.destroy();
            }
        } catch (err) {
            console.warn("Simulator cleanup error:", err);
        }

        // --- Create a fresh simulator with chosen rendering mode ---
        simulator = new SimulatorController();
        simulator.initSim(useWebgl); // async initialization

        console.log(`Renderer switched to: ${useWebgl ? "WebGL" : "Canvas2D"}`);
    };

</script>

</html>